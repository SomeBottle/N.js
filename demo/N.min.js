!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.NDanmaku=e():t.NDanmaku=e()}(self,(function(){return function(){"use strict";var t={421:function(t,e,i){var n=i(81),r=i.n(n),s=i(645),a=i.n(s)()(r());a.push([t.id,"@-webkit-keyframes Ndm-forward{0%{left:100%}to{left:0;-webkit-transform:translateX(-100%);transform:translateX(-100%)}}@keyframes Ndm-forward{0%{left:100%}to{left:0;-webkit-transform:translateX(-100%);transform:translateX(-100%)}}@-webkit-keyframes Ndm-reversed{0%{right:100%}to{right:0;-webkit-transform:translateX(100%);transform:translateX(100%)}}@keyframes Ndm-reversed{0%{right:100%}to{right:0;-webkit-transform:translateX(100%);transform:translateX(100%)}}.N-outline{text-shadow:#000 .5px 0 0,#000 0 .5px 0,#000 -.5px 0 0,#000 0 -.5px 0}.N-scroll{-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards;-webkit-animation-timing-function:linear;animation-timing-function:linear;position:absolute}.N-hanging{left:50%;position:absolute;-webkit-transform:translateX(-50%);transform:translateX(-50%)}.N-scroll-forward{-webkit-animation-name:Ndm-forward;animation-name:Ndm-forward}.N-scroll-reversed{-webkit-animation-name:Ndm-reversed;animation-name:Ndm-reversed}.N-scroll-playing{-webkit-animation-play-state:running;animation-play-state:running}.N-scroll-paused,.N-scroll-paused>.N-scroll{-webkit-animation-play-state:paused;animation-play-state:paused}.N-dmLayer{left:0;overflow:hidden;position:absolute;top:0}",""]),e.Z=a},645:function(t){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",n=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),n&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),n&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,n,r,s){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(n)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(a[l]=!0)}for(var c=0;c<t.length;c++){var h=[].concat(t[c]);n&&a[h[0]]||(void 0!==s&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=s),i&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=i):h[2]=i),r&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=r):h[4]="".concat(r)),e.push(h))}},e}},81:function(t){t.exports=function(t){return t[1]}},379:function(t){var e=[];function i(t){for(var i=-1,n=0;n<e.length;n++)if(e[n].identifier===t){i=n;break}return i}function n(t,n){for(var s={},a=[],o=0;o<t.length;o++){var l=t[o],c=n.base?l[0]+n.base:l[0],h=s[c]||0,u="".concat(c," ").concat(h);s[c]=h+1;var d=i(u),m={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)e[d].references++,e[d].updater(m);else{var f=r(m,n);n.byIndex=o,e.splice(o,0,{identifier:u,updater:f,references:1})}a.push(u)}return a}function r(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,r){var s=n(t=t||[],r=r||{});return function(t){t=t||[];for(var a=0;a<s.length;a++){var o=i(s[a]);e[o].references--}for(var l=n(t,r),c=0;c<s.length;c++){var h=i(s[c]);0===e[h].references&&(e[h].updater(),e.splice(h,1))}s=l}}},569:function(t){var e={};t.exports=function(t,i){var n=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(i)}},216:function(t){t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:function(t,e,i){t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},795:function(t){t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var n="";i.supports&&(n+="@supports (".concat(i.supports,") {")),i.media&&(n+="@media ".concat(i.media," {"));var r=void 0!==i.layer;r&&(n+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),n+=i.css,r&&(n+="}"),i.media&&(n+="}"),i.supports&&(n+="}");var s=i.sourceMap;s&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:function(t){t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var s=e[n]={id:n,exports:{}};return t[n](s,s.exports,i),s.exports}i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,{a:e}),e},i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.nc=void 0;var n={};return function(){i.d(n,{default:function(){return A}});var t=i(379),e=i.n(t),r=i(795),s=i.n(r),a=i(569),o=i.n(a),l=i(565),c=i.n(l),h=i(216),u=i.n(h),d=i(589),m=i.n(d),f=i(421),g={};function p(t,e,i){t instanceof Array||(t=[t]),"string"==typeof e&&(e=[e]),i instanceof Array||(i=[i]);for(let n=0,r=t.length;n<r;n++)if(e instanceof Array)for(let r=0,s=e.length;r<s;r++)t[n].style[e[r]]=i[r];else for(let i in e)t[n].style[i]=e[i]}function v(t,e=1){let i="";switch(e){case 2:i="color:#F5DA81";break;case 3:i="color:#FE2E2E;font-weight:bold"}console.log(`[N.js-Danmaku]%c ${t}`,i)}function b(t,e){for(let i in e)if(!t[i]||t[i]!==e[i])return!1;return!0}function y(){return(new Date).getTime()}g.styleTagTransform=m(),g.setAttributes=c(),g.insert=o().bind(null,"head"),g.domAPI=s(),g.insertStyleElement=u(),e()(f.Z,g),f.Z&&f.Z.locals&&f.Z.locals;class k{constructor(t,e){this.state="running",this.callback=t,this.timer=setTimeout(this.finished.bind(this),e),this.start=y(),this.remaining=e}finished(){this.state="done",this.callback()}pause(){"running"==this.state&&(this.state="paused",clearTimeout(this.timer),this.remaining-=y()-this.start)}resume(){this.remaining>0&&"paused"==this.state&&(this.state="running",this.start=y(),this.timer=setTimeout(this.finished.bind(this),this.remaining))}}const w={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"},S={color:"#FFF",size:null,scale:1,opacity:100,weight:"normal",bottom_space:2,outline:!0,reverse:!1,type:"scroll",life:5e3,custom_css:{}},L={top:0,bottom:0,scroll:0,random:0},x={top:70,bottom:70,scroll:100,random:100};class N{constructor(t){this.target=t,this.hitSets={top:[],bottom:[],scroll:[]},this.resetHitSets()}resetHitSets(){this.danmakuMinHeight=L,this.danmakuMaxHeight=x,this.refreshHitSets()}getMinHeight(t){return.01*this.danmakuMinHeight[t]*this.target.getBoundingClientRect().height}getMaxHeight(t){return.01*this.danmakuMaxHeight[t]*this.target.getBoundingClientRect().height}refreshHitSets(t=""){if("random"==t)return;let e=this,i=t=>{e.hitSets[t].length=0,e.hitSets[t][0]={from:Math.floor(100*e.getMinHeight(t)),to:Math.floor(100*e.getMaxHeight(t)),available:!0,dm:null}};if(t)i(t);else for(let t in this.hitSets)i(t)}setDanmakuPos(t,e){switch(e.type){case"midscroll":case"midhang":p(t,"top",`calc(50% - ${t.offsetHeight/2}px)`);break;case"random":p(t,"top",`${this.danmakuRandom(t)}px`);break;case"top":case"scroll":p(t,"top",`${this.danmakuAnchor(t,e)}px`);break;case"bottom":p(t,"bottom",`${this.danmakuAnchor(t,e)}px`)}}danmakuRandom(t){return this.target.offsetHeight,e=this.getMinHeight("random"),i=this.getMaxHeight("random")-t.offsetHeight,Math.random()*(i-e)+e;var e,i}danmakuAnchor(t,e,i=!1){let n=this.target.getBoundingClientRect(),r=t.getBoundingClientRect().height,s=this.hitSets[e.type],a=e.bottom_space,o=-1;for(let i=0,l=s.length;i<l;i++){let c=s[i];if(c.available){let n=c.to-c.from+1,l=Math.floor(100*(r+a));if(-1===o&&n>=l){let n=Object.assign({},c),r=c.from+l;o=c.from/100,c.to=r-1,c.available=!1,c.dm={start:y(),life:e.life,reversed:e.reverse,element:t},n.from=r,s.splice(i+1,0,n)}}else{let t=c.dm.start,r=c.dm.life,a=c.dm.reversed,o=c.dm.element,h=o.getBoundingClientRect(),u=!1;switch(e.type){case"scroll":u=a?h.left-n.left>0:h.left+h.width<n.width+n.left;break;case"top":case"bottom":u=y()-t>=r}if(0!=o.offsetWidth&&null!=o.parentNode||(u=!0),u){let t=s[i-1]||{},e=s[i+1]||{};t.available&&e.available?(t.to=e.to,s.splice(i,2),i--,l-=2):t.available?(t.to=c.to,s.splice(i,1),i--,l--):e.available?(c.to=e.to,c.available=!0,c.dm=null,s.splice(i+1,1),l--):(c.available=!0,c.dm=null),i--}}}if(-1===o){if(!i)return this.refreshHitSets(e.type),this.danmakuAnchor(t,e,!0);o=0}return o}}const H="N-scroll-paused",E="N-scroll-playing";class D{constructor(t,e,i,n){this.id=t,this.element=e,this.allDanmaku=n;for(let t in i)this[t]=i[t];this.timer?this.category="hanging":this.category="scrolling",n[t]=this}revoke(t=!1){let e=this.element;switch(this.category){case"hanging":this.timer.pause(),e.parentNode&&e.parentNode.removeChild(e);break;case"scrolling":t?e.dispatchEvent(new Event(this.clearEvent)):e.dispatchEvent(new Event(this.endEvent))}delete this.allDanmaku[this.id]}pause(){let t=this.element;switch(this.category){case"hanging":return this.timer.pause(),!0;case"scrolling":if(t.classList.contains(E))return t.classList.replace(E,H),!0}return!1}resume(){let t=this.element;switch(this.category){case"hanging":return this.timer.resume(),!0;case"scrolling":if(t.classList.contains(H))return t.classList.replace(H,E),!0}return!1}get finished(){if("hanging"===this.category){if("done"===this.timer.state)return!0}else if(this.element.offsetWidth<=0||null==this.element.parentNode)return!0;return!1}}console.log("Hey there!ðŸ‘‹ Thank you for using %cN.js%c - SomeBottle","color:#81BEF7;font-weight:bold","");var A=class{constructor(t,e=""){const i=t instanceof Element?t:document.getElementById(t);if(!i)return v("Error: container element not found",3),null;let n;this.target=i,this.prefix=e,this.resetStyles(),this.state="running",p(i,"position","relative"),i.querySelector(".N-dmLayer")?n=i.querySelector(".N-dmLayer"):(n=document.createElement("div"),p(n,["width","height","top","left"],["100%","100%","0px","0px"]),n.className="N-dmLayer",i.appendChild(n)),this.dmLayer=n,this.hitBox=new N(n),this.monitor=new class{constructor(){this.dmSerial=0,this.allDanmaku=new Object,this.hanging=[],this.scrolling=[]}statistics(){let t={total:0,garbages:0,scrolling:{total:0,reversed:0,garbages:0,scroll:{total:0,reversed:0,garbages:0},random:{total:0,reversed:0,garbages:0},midscroll:{total:0,reversed:0,garbages:0}},hanging:{total:0,garbages:0,top:{total:0,garbages:0},bottom:{total:0,garbages:0},midhang:{total:0,garbages:0}}};for(let e in this.allDanmaku){let i=this.allDanmaku[e],n=i.category,r=i.type;i.finished?(t.garbages++,t[n].garbages++,t[n][r].garbages++):(t.total++,t[n].total++,t[n][r].total++,i.reversed&&(t.scrolling.reversed++,t.scrolling[r].reversed++))}return t}garbageCollect(t=""){let e=this.scrolling,i=this.hanging;if(!t||"scrolling"===t)for(let t=0,i=e.length;t<i;t++)e[t].finished&&(e[t].revoke(),e.splice(t,1),t--,i--);if(!t||"hanging"===t)for(let t=0,e=i.length;t<e;t++)i[t].finished&&(i[t].revoke(),i.splice(t,1),t--,e--)}newScroll(t,e,i,n=null){let r="";for(let e in w)if(e in t.style){r=w[e];break}if(!r)return void v("Oops, your browser is outdated.",3);let s=this.dmSerial,a=function(){this.removeEventListener(r,a),this.removeEventListener("danmakuclear",o),this.parentNode.removeChild(this),n&&n(s)}.bind(t),o=function(){this.removeEventListener(r,a),this.removeEventListener("danmakuclear",o),this.parentNode.removeChild(this)}.bind(t),l=this.scrolling;t.addEventListener(r,a),t.addEventListener("danmakuclear",o),this.garbageCollect("scrolling");let c=new D(s,t,{type:e,reversed:i,endEvent:r,clearEvent:"danmakuclear"},this.allDanmaku);return l.push(c),this.dmSerial++,s}newHang(t,e,i,n=null){let r=this.dmSerial,s=new k((()=>{t.parentNode.removeChild(t),n&&n(r)}),i),a=this.hanging;this.garbageCollect("hanging");let o=new D(r,t,{timer:s,type:e},this.allDanmaku);return a.push(o),this.dmSerial++,r}clearSomeScrolling(t="",e=!1){let i=this.scrolling;for(let n=0,r=i.length;n<r;n++){let s=i[n];(!t||"all"==t&&"all"==e||"all"==t&&s.reversed==e||s.type==t&&"all"==e||s.type==t&&s.reversed==e)&&(s.revoke(!0),i.splice(n,1),n--,r--)}}clearSomeHanging(t=""){let e=this.hanging;for(let i=0,n=e.length;i<n;i++){let r=e[i];t&&"all"!=t&&r.type!=t||(r.timer.pause(),r.revoke(!0),e.splice(i,1),i--,n--)}}clearStyled(t){let e=this.hanging,i=this.scrolling;for(let i=0,n=e.length;i<n;i++)b(e[i].element.style,t)&&(e[i].revoke(!0),e.splice(i,1),i--,n--);for(let e=0,n=i.length;e<n;e++)b(i[e].element.style,t)&&(i[e].revoke(!0),i.splice(e,1),e--,n--)}clearSingle(t){let e=this.allDanmaku[t];return e?e.revoke(!0):(v(`DanmakuID:${t} not found.`,2),!1)}pauseSingle(t){let e=this.allDanmaku[t];return e?e.pause():(v(`DanmakuID:${t} not found.`,2),!1)}resumeSingle(t){let e=this.allDanmaku[t];return e?e.resume():(v(`DanmakuID:${t} not found.`,2),!1)}pauseAllHanging(){for(let t=0,e=this.hanging.length;t<e;t++)this.hanging[t].pause()}resumeAllHanging(){for(let t=0,e=this.hanging.length;t<e;t++)this.hanging[t].resume()}},this.list=new class{constructor(t,e){this.danmaku=e,this.target=t,this.lists={},this.usingList=null}uncertainty(t){if(!this.usingList)return v("Use one list first.",2),null;t>=0?this.usingList.uncertainty=t:v("Uncertainty should be a positive number",2)}load(t){if(this.usingList){for(let e=0,i=t.length;e<i;e++){let i=t[e],n=i.time;n&&(delete i.time,this.addDm(i,n))}return v("Successfully loaded."),!0}return v("Use one list first.",2),!1}tick(t){let e=this.usingList,i=e.timeLine,n=e.uncertainty;if(e){let r=0,s=i.length-1,a=[];for(;r<=s;){let e=Math.floor((r+s)/2),n=i[e][0],o=i[e][1];if(n==t){a.push(o),r=e+1,s=e-1;break}n<t?r=e+1:n>t&&(s=e-1)}let o=t-n,l=t+n;for(let t=i.length;r<t&&i[r][0]<=l;r++)a.push(i[r][1]);for(;s>=0&&i[s][0]>=o;s--)a.unshift(i[s][1]);let c=e.danmakuLine;for(let t=0,e=a.length;t<e;t++){let e=c[a[t]],i=this.danmaku;e.reset_styles&&i.resetStyles(),e.styles&&i.attrs(e.styles),i.create(e.text,e.created instanceof Function?e.created:null,e.callback instanceof Function?e.callback:null)}}else v("Use one list first.",2)}addDm(t,e){let i=this.usingList;if(i){if(!(t instanceof Object&&"number"==typeof e&&e>=0))return v("Invalid parameters!",3),null;if(!t.hasOwnProperty("text"))return v("Lack of necessary properties in danmakuData!",3),null;let n=`ld${i.dmSerial}`;i.danmakuLine[n]=t;let r=0,s=i.timeLine.length,a=!1;do{let t=i.timeLine[r];if(!t||t[0]>e){i.timeLine.splice(r,0,[e,n]),a=!0;break}r++}while(r<s);return a||i.timeLine.push([e,n]),i.dmSerial++,n}return v("Use one list first.",2),null}delDm(t){let e=this.usingList;if(e){if(e.danmakuLine[t]){delete e.danmakuLine[t];for(let i=0,n=e.timeLine.length;i<n;i++)if(e.timeLine[i][1]==t){e.timeLine.splice(i,1);break}return!0}}else v("Use one list first.",2);return!1}use(t){this.lists[t]?this.usingList=this.lists[t]:v(`List ${t} not found!`,3)}new(t){this.lists[t]?v(`List ${t} already exists!`,3):this.lists[t]={timeLine:new Array,danmakuLine:new Object,uncertainty:200,dmSerial:0}}del(t){this.lists[t]?delete this.lists[t]:v(`List ${t} not found!`,3)}}(n,this)}get statistics(){let t=this.monitor.statistics();return t.global_state=this.state,t}resetStyles(){return this.currentAttrs=Object.assign({},S),this.currentAttrs.custom_css=Object.assign({},this.currentAttrs.custom_css),this}resetRange(){return this.hitBox.resetHitSets(),this}create(t,e=null,i=null){if(this.dmLayer.offsetWidth<=0||null===this.dmLayer.parentNode)return v("Warning: Danmaku layer not found.",2),this;let n=this.currentAttrs,r=document.createElement("div"),s=document.createTextNode(t),a=n.size,o=n.life,l=n.reverse;if(this.height=this.target.offsetHeight,this.width=this.target.offsetWidth,r.appendChild(s),!a){let t=function(t){let e=t.offsetWidth/180*5;return e>5?e:5}(this.target);n.scale>0&&(t*=n.scale),a=`${t}px`}p(r,{position:"absolute","font-size":a,color:n.color,"font-weight":n.weight,opacity:.01*n.opacity,"word-break":"keep-all","white-space":"pre","animation-duration":`${o}ms`,"-webkit-animation-duration":`${o}ms`,"-moz-animation-duration":`${o}ms`,"-o-animation-duration":`${o}ms`}),n.outline&&r.classList.add("N-outline"),p(r,n.custom_css),this.dmLayer.appendChild(r);let c=null;switch(n.type){case"scroll":case"random":case"midscroll":r.classList.add("N-scroll-playing",l?"N-scroll-reversed":"N-scroll-forward","N-scroll"),c=this.monitor.newScroll(r,n.type,l,i);break;case"top":case"bottom":case"midhang":r.classList.add("N-hanging"),c=this.monitor.newHang(r,n.type,n.life,i);break;default:return v("Error: Unknown danmaku type.",3),this.dmLayer.removeChild(r),this}return this.hitBox.setDanmakuPos(r,n),this.prefix&&(r.id=`N-danmaku-${this.prefix}-${c}`),e&&e(r,c),this}clearSome(t="",e="all"){switch(t){case"random":case"scroll":case"midscroll":this.monitor.clearSomeScrolling(t,e);break;case"top":case"bottom":case"midhang":this.monitor.clearSomeHanging(t);break;case"all":this.monitor.clearSomeScrolling("all",e),this.monitor.clearSomeHanging("all");break;case"scrolling":this.monitor.clearSomeScrolling("all",e);break;case"hanging":this.monitor.clearSomeHanging();break;default:this.monitor.clearSomeScrolling(),this.monitor.clearSomeHanging()}return this}clearStyled(t){this.monitor.clearStyled(t)}clear(t=null){return t?this.monitor.clearSingle(t):this.clearSome(),this}pause(t=null){return t?(this.monitor.pauseSingle(t),this):("running"==this.state&&(this.dmLayer.classList.add("N-scroll-paused"),this.monitor.pauseAllHanging(),this.state="paused"),this)}resume(t=null){return t?(this.monitor.resumeSingle(t),this):("paused"==this.state&&(this.dmLayer.classList.remove("N-scroll-paused"),this.monitor.resumeAllHanging(),this.state="running"),this)}attrs(t,e=null){if(t instanceof Object)for(let e in t)this.currentAttrs[e]=t[e];else void 0!==this.currentAttrs[t]?this.currentAttrs[t]=e:v(`Error: Danmaku attribute not found: ${t}`,3);return this}range(t,e=null){let i=this.hitBox.danmakuMaxHeight,n=this.hitBox.danmakuMinHeight;if(t instanceof Object)for(let e in t)void 0!==i[e]&&(n[e]=t[e][0],i[e]=t[e][1],this.hitBox.refreshHitSets(e));else void 0!==i[t]?(n[t]=e[0],i[t]=e[1],this.hitBox.refreshHitSets(t)):v(`Error: Danmaku type not found: ${t}`,3);return this}}}(),n.default}()}));